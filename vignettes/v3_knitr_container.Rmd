---
title: "`knitr_container` Examples"
subtitle: "(spPlot v`r packageVersion('spPlot')`)"
author: "Vilmantas Gegzna"
date: "`r Sys.Date()`"
output:
    rmarkdown::html_vignette: 
        toc: yes
        number_sections: yes

vignette: >
  %\VignetteIndexEntry{3 plotly and knitr Examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteDepends{plotly,spHelper}
  %\VignetteEncoding{UTF-8}
---
```{r options1, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(collapse = TRUE,
                      comment = "#>",
                      fig.align = 'center')
optDEF <- knitr::opts_chunk$get()
```


Functions for class `knitr_container`   
===============================================

Load packages.

```{r Load main package, message = FALSE, warning = FALSE}
library(spHelper)
library(spPlot)
```


Create necessary objects.
```{r}
plotly_obj <- plot_ly(economics, x = date, y = uempmed, type = "scatter",
             showlegend = FALSE)

ggplot_obj <- qplot(mpg, wt, data = mtcars, colour = cyl)
```

Create `knitr_container`.
```{r}
obj <- knitr_container()
class(obj)
obj
```

Attach objects to the end of the container.

```{r}
obj <- add_as_section(obj, "Plots")

obj <- add_as_section(obj, "Add `plotly`", level = 2)
obj <- add_as_plotly_widget(obj, plotly_obj)

obj <- add_as_section(obj, "Add `ggplot` as `plotly`", level = 2)
obj <- add_as_plotly_widget(obj, ggplot_obj)

obj <- add_as_section(obj, "Add `ggplot`", level = 2)
obj <- add_as_is(obj, ggplot_obj)

obj <- add_as_section(obj, "Attention: Not Plotted", level = 1)
obj <- add_as_is(obj, plotly_obj)
obj <- add_as_text(obj, paste("As you noticed, the last",
      "`plotly` object was not plotted as it was added with ",
      "`add_as_is()` and not with `add_as_plotly_widget()`"))


obj <- add_as_section(obj, "Pander and text", level = 1)

obj <- add_as_section(obj, "As pander", level = 2)
obj <- add_as_pander(obj, summary(mtcars))

obj <- add_as_section(obj, "As text", level = 2)
obj <- add_as_text(obj, summary(mtcars))

obj <- add_as_section(obj, "As is", level = 2)
obj <- add_as_is(obj, summary(mtcars))

```

Explore the container
=======================

Note, that functions `summary(obj)` and `print(obj)` do the same action: print
summary of the object

```{r}
print(obj)

is.knitr_container(obj) 
is.knitr_container(ggplot_obj)

as.knitr_container(ggplot_obj) 

class(obj)
```
Merge several containers.

```{r}
Join(obj, obj)   %>% length()
```

Convert (as is) to `knitr_container` and merge.
```{r}
Join(obj, ggplot_obj)   %>% length()
```


As function uses method "as is" to convert to `knitr_container`, 
`plotly` objects might not be printed from the container in some situations
(e.g. from inside `for` loops using `knitr`).

```{r}
Join(ggplot_obj, plotly_obj)
```
In these situations it is better to apply function `add_as_plotly_widget` first.




Print objects from the container (`print_objects`)
==================================================

In section **2** there we demonstrated how to create a `knitr_nontainer`. In this
section we will demonstrate how to print all the objects from the container.

For this purpose a special function `print_objects` was created. As we use 
`knitr` and `R MArkdown` we recommend to use separate R code chunk to apply the
 function. It is <font color ="red"> IMPORTANT </font> to make 
 sure that R chunk, in which `print_objects()` is called, has option `results` 
 set to `as is` (`{r, results = 'asis'}`). Otherwise incorrect results are 
 expected.

The following text, section headings, figures etc. (except section 
"Session information") are printed from the container
using the following syntax:  

```{r, results = 'asis'}
print_objects(obj)
```



Session information
===================


```{r session info}
devtools::session_info()
```
